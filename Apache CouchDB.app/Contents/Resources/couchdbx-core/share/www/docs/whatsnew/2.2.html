<!--
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed
under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.
-->

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>15.1. 2.2.x Branch &mdash; Apache CouchDB 2.2 Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  
    <link rel="canonical" href="http://docs.couchdb.org/en/stable/whatsnew/2.2.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/rtd_theme.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="next" title="15.2. 2.1.x Branch" href="2.1.html" />
    <link rel="prev" title="15. Release History" href="index.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Apache CouchDB
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
<h2>Table of Contents</h2>

            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">2. Installation &amp; First-Time Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">3. Configuring CouchDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replication/index.html">4. Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintenance/index.html">5. CouchDB Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ddocs/index.html">6. Design Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../query-server/index.html">7. Query Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fauxton/index.html">8. Fauxton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../best-practices/index.html">9. Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">10. API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster/index.html">11. Cluster Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../json-structure.html">12. JSON Structure Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../experimental.html">13. Experimental Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">14. Contributing to this Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">15. Release History</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">15.1. 2.2.x Branch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#upgrade-notes">15.1.1. Upgrade Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#version-2-2-0">15.1.2. Version 2.2.0</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#features">15.1.2.1. Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance">15.1.2.2. Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bugfixes">15.1.2.3. Bugfixes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mango">15.1.2.4. Mango</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other">15.1.2.5. Other</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2.1.html">15.2. 2.1.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="2.0.html">15.3. 2.0.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.7.html">15.4. 1.7.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.6.html">15.5. 1.6.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.5.html">15.6. 1.5.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.4.html">15.7. 1.4.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.3.html">15.8. 1.3.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.2.html">15.9. 1.2.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.1.html">15.10. 1.1.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.0.html">15.11. 1.0.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="0.11.html">15.12. 0.11.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="0.10.html">15.13. 0.10.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="0.9.html">15.14. 0.9.x Branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="0.8.html">15.15. 0.8.x Branch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cve/index.html">16. Security Issues Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cve/index.html#reporting-new-security-problems-with-apache-couchdb">17. Reporting New Security Problems with Apache CouchDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">18. About CouchDB Documentation</a></li>
</ul>

            
          
<h2>Quick Reference</h2>
<ul>
<li><a href="../http-api.html">HTTP API Reference</a></li>
<li><a href="../config-ref.html">Configuration Reference</a></li>
</ul>


<h2>Local Links</h2>
<ul>
<li><a href="../">Fauxton</a></li>
</ul>


<h2>More Help</h2>
<ul>
<li><a href="https://couchdb.apache.org/">CouchDB Homepage</a></li>
<li><a href="https://couchdb.apache.org/#mailing-list">Mailing Lists</a></li>
<li><a href="http://webchat.freenode.net/?channels=couchdb">IRC</a></li>
<li><a href="https://github.com/apache/couchdb/issues">Issue Tracker</a></li>
<li><a href="../download.html">Download Docs</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache CouchDB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">15. Release History</a> &raquo;</li>
        
      <li>15.1. 2.2.x Branch</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/couchdb-documentation/blob/master/src/whatsnew/2.2" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="x-branch">
<span id="release-2-2-x"></span><h1>15.1. 2.2.x Branch<a class="headerlink" href="#x-branch" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#upgrade-notes" id="id1">Upgrade Notes</a></li>
<li><a class="reference internal" href="#version-2-2-0" id="id2">Version 2.2.0</a></li>
</ul>
</div>
<div class="section" id="upgrade-notes">
<span id="release-2-2-x-upgrade"></span><h2><a class="toc-backref" href="#id1">15.1.1. Upgrade Notes</a><a class="headerlink" href="#upgrade-notes" title="Permalink to this headline">¶</a></h2>
<ul class="open">
<li><p class="first">The minimum supported version of Erlang is now 17, not R16B03. Support for Erlang 21
is still ongoing and will be provided in a future release.</p>
</li>
<li><p class="first">The CouchDB replication client can now use the <tt class="docutils literal"><span class="pre">/_session</span></tt> endpoint when
authenticating against remote CouchDB instances, improving performance since
re-authorization does not have to be performed with every request. Because of
this performance improvement, it is recommended to increase the PBKDF2 work
factor beyond the default <tt class="docutils literal"><span class="pre">10</span></tt> to a modern default such as <tt class="docutils literal"><span class="pre">10000</span></tt>. This is done
via the local ini file setting <tt class="docutils literal"><span class="pre">[couch_httpd_auth]</span> <span class="pre">iterations</span> <span class="pre">=</span> <span class="pre">10000</span></tt>.</p>
<p>Do <strong>not</strong> do this if an older version of CouchDB is replicating TO this instance or
cluster regularly, since CouchDB &lt; 2.2.0 must perform authentication on every request
and replication performance will suffer.</p>
<p>A future version will make this increased number of iterations a default.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/820">#820</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1032">#1032</a>: Multiple queries can now be made at the
<tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/{db}/_all_docs/queries</span></tt>, <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/{db}/_design_docs/queries</span></tt> and
<tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/{db}/_local_docs/queries</span></tt> endpoints. Also, a new endpoint
<tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/{db}/_design/{ddoc}/_view/{view}/queries</span></tt> has been introduced to replace
the <tt class="docutils literal"><span class="pre">?queries</span></tt> parameter formerly provided for making multiple queries to a view.
The old <tt class="docutils literal"><span class="pre">?queries</span></tt> parameter <em>is now deprecated and will be removed in a future
release of CouchDB.</em></p>
</li>
<li><p class="first">The maximum http request limit, which had been lowered in 2.1.0, has been re-raised
to a 4GB limit for now. (<a class="reference external" href="https://github.com/apache/couchdb/issues/1446">#1446</a>). Ongoing discussion about the path forward
for future releases is available in <a class="reference external" href="https://github.com/apache/couchdb/issues/1200">#1200</a> and <a class="reference external" href="https://github.com/apache/couchdb/issues/1253">#1253</a>.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1118">#1118</a>: The least recently used (LRU) cache of databases is now only updated
on database write, not read. This has lead to significant performance enhancements
on very busy clusters. To restore the previous behaviour, your local ini file can
contain the block <tt class="docutils literal"><span class="pre">[couchdb]</span> <span class="pre">update_lru_on_read</span> <span class="pre">=</span> <span class="pre">true</span></tt>.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1153">#1153</a>: The CouchDB replicator can now make use of the <tt class="docutils literal"><span class="pre">/_session</span></tt> endpoint
rather than relying entirely on HTTP basic authentication headers. This can greatly
improve replication performance. We encourage you to upgrade any nodes or clusters that
regularly act as replication clients to use this new feature, which is enabled by
default (<a class="reference external" href="https://github.com/apache/couchdb/issues/1462">#1462</a>).</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1283">#1283</a>: The <tt class="docutils literal"><span class="pre">[couchdb]</span> <span class="pre">enable_database_recovery</span></tt> feature, which only
soft-deletes databases in response to a <tt class="docutils literal"><span class="pre">DELETE</span> <span class="pre">/{db}</span></tt> call, is now documented in
<tt class="docutils literal"><span class="pre">default.ini</span></tt>.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1330">#1330</a>: CouchDB externals and OS daemons are now officially deprecated and no
longer documented. Support for these features will be completely removed in a future
release of CouchDB (probably 3.0.0).</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1436">#1436</a>: CouchDB proxy authentication now uses a proper <tt class="docutils literal"><span class="pre">chttpd_auth</span></tt>
module, simplifying configuration in local ini files. While this is not a backward-
compatible breaking change, it is best to update your local ini files to reference the
new <tt class="docutils literal"><span class="pre">{chttpd_auth,</span> <span class="pre">proxy_authentication_handler}</span></tt> handler rather than the
<tt class="docutils literal"><span class="pre">couch_httpd_auth</span></tt> version, as <tt class="docutils literal"><span class="pre">couch_httpd</span></tt> is in the process of being deprecated
completely.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1476">#1476</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1477">#1477</a>: The obsolete <cite>update_notification</cite> feature, which
was replaced by <cite>/{db}/_changes</cite> feeds c. CouchDB 1.2, has been completely removed.
This feature never worked in 2.0 for databases, only for shards, making it effectively
useless.</p>
</li>
</ul>
</div>
<div class="section" id="version-2-2-0">
<h2><a class="toc-backref" href="#id2">15.1.2. Version 2.2.0</a><a class="headerlink" href="#version-2-2-0" title="Permalink to this headline">¶</a></h2>
<div class="section" id="features">
<h3>15.1.2.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<ul class="open">
<li><p class="first">Much improved documentation. Highlights include:</p>
<ul class="simple">
<li>A complete rewrite of the <a class="reference internal" href="../cluster/sharding.html#cluster-sharding"><em>sharding</em></a> documentation.</li>
<li>Developer installation notes (<tt class="docutils literal"><span class="pre">INSTALL.*.rst</span></tt>)</li>
<li>Much of the content of the original CouchDB Wiki has been imported into the
official docs. (The old CouchDB Wiki is in the process of being deprecated.)</li>
</ul>
</li>
<li><p class="first">Much improved Fauxton functionality. Highlights include:</p>
<ul class="simple">
<li>Search support in the code editor</li>
<li>Support for relative Fauxton URLs (<em>i.e.</em>, not always at <tt class="docutils literal"><span class="pre">/_utils</span></tt>)</li>
<li>Replication setup enhancements for various authentication mechanisms</li>
<li>Fixes for IE10, IE11, and Edge (we hope...)</li>
<li>Resolving conflicts of design documents is now allowed</li>
</ul>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/496">#496</a>, <a class="reference external" href="https://issues.apache.org/jira/browse/COUCHDB-3287">COUCHDB-3287</a>: New pluggable storage engine framework has landed in
CouchDB. This internal refactor makes it possible for CouchDB to use different backends
for storing the base database file itself. The refactor included a full migration of
the existing &#8220;legacy&#8221; storage engine into the new framework.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/603">#603</a>: When creating a new database on a cluster without quorum, CouchDB will
now return a <tt class="docutils literal"><span class="pre">202</span> <span class="pre">Accepted</span></tt> code if possible, indicating that at least one node
has written the database record to disk, and that other nodes will be updated as they
return to an online state. This replaces the former <tt class="docutils literal"><span class="pre">500</span></tt> internal error.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1136">#1136</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1139">#1139</a>: When deleting a database in a cluster without
quorum, CouchDB will no longer throw a <tt class="docutils literal"><span class="pre">500</span></tt> error status, but a <tt class="docutils literal"><span class="pre">202</span></tt> as long as
at least one node records the deletion, or a <tt class="docutils literal"><span class="pre">200</span></tt> when all nodes respond. This fix
parallels the one made for <a class="reference external" href="https://github.com/apache/couchdb/issues/603">#603</a>.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/745">#745</a>: CouchDB no longer fails to complete replicating databases with
large attachments. The fix for this issue included several related changes:</p>
<ul class="simple">
<li>The maximum http request limit, which had been lowered in 2.1.0, has been re-raised
to a 4GB limit for now. (<a class="reference external" href="https://github.com/apache/couchdb/issues/1446">#1446</a>). Ongoing discussion about the path forward
for future releases is available in <a class="reference external" href="https://github.com/apache/couchdb/issues/1200">#1200</a> and <a class="reference external" href="https://github.com/apache/couchdb/issues/1253">#1253</a>.</li>
<li>An update to the replicator http client that improves active socket accounting,
without which CouchDB can cease to be responsive over the main http interface
(<a class="reference external" href="https://github.com/apache/couchdb/issues/1117">#1117</a>)</li>
<li>The replicator&#8217;s http client no longer performs unconditional retries on failure
(<a class="reference external" href="https://github.com/apache/couchdb/issues/1177">#1177</a>)</li>
<li>A path by which CouchDB could lose track of their RPC workers during multipart
attachment processing was removed. (<a class="reference external" href="https://github.com/apache/couchdb/issues/1178">#1178</a>)</li>
<li>When CouchDB transmits a <tt class="docutils literal"><span class="pre">413</span> <span class="pre">Payload</span> <span class="pre">Too</span> <span class="pre">Large</span></tt> response on attachment upload,
it now correctly flushes the receive socket before closing the connection to avoid
a TCP reset, and to give the client a better chance of parsing the 413 response. In
tandem, the replicator http client correctly closes its own socket after processing
any 413 response. (<a class="reference external" href="https://github.com/apache/couchdb/issues/1234">#1234</a>)</li>
<li>A <tt class="docutils literal"><span class="pre">fabric</span></tt> process to receive unchunked attachments can no longer orphan processes
that leave unprocessed binaries in memory until all available memory is exhausted.
(<a class="reference external" href="https://github.com/apache/couchdb/issues/1264">#1264</a>).</li>
<li>When using CouchDB&#8217;s native SSL responder (port 6984 by default), sessions are now
timed out by default after 300s. This is to work around RAM explosion in the BEAM VM
when using the Erlang-native SSL libraries. (<a class="reference external" href="https://github.com/apache/couchdb/issues/1321">#1321</a></li>
</ul>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/822">#822</a>: A new end point <a class="reference internal" href="../api/server/common.html#api-server-dbs-info"><em>/_dbs_info</em></a> has been added to return
information about a list of specified databases. This endpoint can take the place of
multiple queries to <tt class="docutils literal"><span class="pre">/{db}</span></tt>.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/875">#875</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1030">#1030</a>: <tt class="docutils literal"><span class="pre">couch_peruser</span></tt> installations can now specify a
default <tt class="docutils literal"><span class="pre">q</span></tt> value for each peruser-created database that is different from the
cluster&#8217;s <tt class="docutils literal"><span class="pre">q</span></tt> value. Set this in your local ini file, under <tt class="docutils literal"><span class="pre">[couch_peruser]</span> <span class="pre">q</span></tt>.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/876">#876</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1068">#1068</a>: The <tt class="docutils literal"><span class="pre">couch_peruser</span></tt> database prefix is now
configurable through your local ini file, under <tt class="docutils literal"><span class="pre">[couch_peruser]</span> <span class="pre">database_prefix</span></tt>.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/887">#887</a>: Replicator documents can now include parameters for target database
creation, such as <tt class="docutils literal"><span class="pre">&quot;create_target_params&quot;:</span> <span class="pre">{&quot;q&quot;:</span> <span class="pre">&quot;1&quot;}</span></tt>. This can assist in
database resharding or placement.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/977">#977</a>: When using <tt class="docutils literal"><span class="pre">COPY</span></tt> to copy a document, CouchDB no longer fails if
the new ID includes Unicode characters.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1095">#1095</a>: Recognize the environment variables <tt class="docutils literal"><span class="pre">ARGS_FILE</span></tt>, <tt class="docutils literal"><span class="pre">SYSCONFIG_FILE</span></tt>,
<tt class="docutils literal"><span class="pre">COUCHDB_ARGS_FILE</span></tt> and <tt class="docutils literal"><span class="pre">COUCHDB_SYSCONFIG_FILE</span></tt> to overrride where CouchDB looks
for the <tt class="docutils literal"><span class="pre">vm.args</span></tt> and <tt class="docutils literal"><span class="pre">sys.config</span></tt> files at startup.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1101">#1101</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1425">#1425</a>: Mango can now be used to find conflicted documents
in a database by adding <tt class="docutils literal"><span class="pre">conflicts:</span> <span class="pre">true</span></tt> to a mango selector.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1126">#1126</a>: When queried back after saving, replication documents no longer
contain sensitive credential information (such as basic authenticataion headers).</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1203">#1203</a>:</p>
<blockquote>
<div><ul class="simple">
<li>The compaction daemon now has a snooze period, during which it waits to start
the next compaction after finishing the previous one. This value is useful in
setups with many databases (e.g. with <tt class="docutils literal"><span class="pre">couch_peruser</span></tt>) or many design docs,
which can cause a CPU spike every <tt class="docutils literal"><span class="pre">check_interval</span></tt> seconds. The setting can
be adjusted in your local ini file via <tt class="docutils literal"><span class="pre">[compaction_daemon]</span> <span class="pre">snooze_period</span></tt>.
The current default is a 3 second pause.</li>
<li>The <tt class="docutils literal"><span class="pre">check_interval</span></tt> has been raised from 300 seconds to 3600 seconds.</li>
<li>A <tt class="docutils literal"><span class="pre">notice</span></tt>-level log about closing view indexes has been demoted to the
<tt class="docutils literal"><span class="pre">debug</span></tt> level. In a sceario with many design docs, this would createsignficant
load on the logging subsystem every <tt class="docutils literal"><span class="pre">[compaction_daemon]</span> <span class="pre">check_interval</span></tt> for
no discernible benefit.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1309">#1309</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1435">#1435</a>: CouchDB now reports the git sha at the time of build
in the top-level <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/</span></tt> version string, in a new <tt class="docutils literal"><span class="pre">git_sha</span></tt> key. This can be used
to help ensure an unmodified version of CouchDB has been built and is running on any
given machine.</p>
</li>
<li><p class="first"><a class="reference external" href="https://issues.apache.org/jira/browse/COUCHDB-2971">COUCHDB-2971</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1346">#1346</a>: CouchDB now includes a new builtin reduce function
<tt class="docutils literal"><span class="pre">_approx_count_distinct</span></tt>, that uses a HyperLogLog algorithm to estimate the number of
distinct keys in the view index. The precision is currently fixed to 2^11 observables,
and therefore uses approximately 1.5KB of memory.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1377">#1377</a>: CouchDB finalization of view reduces now occurs at the coordinator
node. This simplified the built-in <tt class="docutils literal"><span class="pre">_stats</span></tt> function.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1392">#1392</a>: When running CouchDB under Erlang 19.0 or newer, messages can now be
stored off the process heap. This is extremely useful for Erlang processes that can
have huge number of messages in their mailbox, and is now enabled for <tt class="docutils literal"><span class="pre">couch_server</span></tt>,
<tt class="docutils literal"><span class="pre">couch_log_server</span></tt>, <tt class="docutils literal"><span class="pre">ddoc_cache</span></tt>, <tt class="docutils literal"><span class="pre">mem3_shards</span></tt>, and <tt class="docutils literal"><span class="pre">rexi_server</span></tt> whenever
possible.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1424">#1424</a>: The CouchDB native SSL/TLS server <tt class="docutils literal"><span class="pre">httpsd</span></tt> now accepts socket-level
configuration options through the <tt class="docutils literal"><span class="pre">[httpsd]</span> <span class="pre">server_options</span></tt> ini file setting.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1440">#1440</a>: CouchDB can now be configured to prevent non-admins from accessing
the <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/_all_dbs</span></tt> method by specifying <tt class="docutils literal"><span class="pre">[chttpd]</span> <span class="pre">admin_only_all_dbs</span> <span class="pre">=</span> <span class="pre">true</span></tt> in
your local ini file(s). The <tt class="docutils literal"><span class="pre">true</span></tt> setting will become default in future versions.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1171">#1171</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1445">#1445</a>: CouchDB can now be configured to use the internal
Erlang MD5 hash function when not available in the external environment (e.g. FIPS
enabled CentOS) at compile time with the <tt class="docutils literal"><span class="pre">configure</span></tt> flag <tt class="docutils literal"><span class="pre">--enable-md5</span></tt>. Because
this implementation is slower, it is not recommended in the general case.</p>
</li>
</ul>
</div>
<div class="section" id="performance">
<h3>15.1.2.2. Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h3>
<ul class="open">
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/958">#958</a>: The revision stemming algorithm was optimized down from <em>O(N^2)</em> to
<em>O(N)</em> via a depth-first search approach, and then further improved by calling the
stemming operation only when necessary. This new algorithm can be disabled by
setting the option <tt class="docutils literal"><span class="pre">[couchdb]</span> <span class="pre">stem_interactive_updates</span> <span class="pre">=</span> <span class="pre">false</span></tt> if necessary.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1246">#1246</a>: CouchDB now checks for request authorization only once per each
database request, improving the performance of any request that requires
authorization.</p>
</li>
</ul>
</div>
<div class="section" id="bugfixes">
<h3>15.1.2.3. Bugfixes<a class="headerlink" href="#bugfixes" title="Permalink to this headline">¶</a></h3>
<ul class="open">
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/832">#832</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1064">#1064</a>: Tracking of Couch logging stats has been added back
into the per-node <tt class="docutils literal"><span class="pre">/_node/&lt;node-name&gt;/_stats</span></tt> endpoint.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/953">#953</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/973">#973</a>: Return <tt class="docutils literal"><span class="pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span></tt> on <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/_scheduler</span></tt>,
not <tt class="docutils literal"><span class="pre">405</span> <span class="pre">Method</span> <span class="pre">Not</span> <span class="pre">Allowed</span></tt>.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/955">#955</a>: The <tt class="docutils literal"><span class="pre">/{db}/_bulk_docs</span></tt> endpoint now correctly responds with a
<tt class="docutils literal"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></tt> error if the <tt class="docutils literal"><span class="pre">new_edits</span></tt> parameter is not a boolean.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/969">#969</a>: CouchDB now returns <tt class="docutils literal"><span class="pre">offset</span></tt> and <tt class="docutils literal"><span class="pre">update_seq</span></tt> values when <tt class="docutils literal"><span class="pre">keys</span></tt>
are provided to the <tt class="docutils literal"><span class="pre">GET</span></tt> or <tt class="docutils literal"><span class="pre">POST</span></tt> <tt class="docutils literal"><span class="pre">/{db}/_all_docs?update_seq=true</span></tt> endpoints.
This was affecting PouchDB compatibility.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/984">#984</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1434">#1434</a>: CouchDB views now retain their <tt class="docutils literal"><span class="pre">update_seq</span></tt> after
compaction, preventing potentially expensive client-side view rewinds after compaction.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1012">#1012</a>: Address a theoretical race condition the replication scheduler could
encounter when trying to determine if the cluster is &#8220;stable&#8221; enough to resume
handling replication-introduced document updates.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1051">#1051</a>: Return a user-friendly error message when attempting to create a
CouchDB user with an invalid password field (non-string).</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1059">#1059</a>: DB-specific compaction configurations were not working correctly. The
syntax now also supports shard-level custom compaction configuration if desired (which
it probably isn&#8217;t.)</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1097">#1097</a>: Compaction daemon will not crash out when trying to check specific
file system mounts that are not &#8220;real&#8221; file systems (like <tt class="docutils literal"><span class="pre">/run</span></tt> on Linux).</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1198">#1198</a>: Fauxton is no longer available on the node-local port (5986, by
default). The node-local port is only to be used for specific administrative tasks;
removing the Fauxton interface prevents mistaking the node-local port as the correct
CouchDB port (5984, by default).</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1165">#1165</a>: <tt class="docutils literal"><span class="pre">validate_doc_update</span></tt> view functions can once again be implemented
directly in Erlang (after enabling the optional Erlang view server).</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1223">#1223</a>: The <tt class="docutils literal"><span class="pre">couch_config</span></tt> application now correctly handles non-persistent
integer and boolean-valued configuration changes.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1242">#1242</a>: <tt class="docutils literal"><span class="pre">couch_os_daemons</span></tt> may now reside in directories with spaces.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1258">#1258</a>: CouchDB will now successfully login users, even if password encryption
is very slow.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1276">#1276</a>: The replication scheduler status for a repeatedly erroring job now
correctly reflects the <cite>crashing</cite> state in more scenarios.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1375">#1375</a>: If CouchDB fails authorization but passes authentication, it no longer
drops the <tt class="docutils literal"><span class="pre">user_ctx</span></tt> out of the request.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1390">#1390</a>: The active size of views (as returned in a database info response) no
longer is incorrectly calculated in such a way that it could occasionally be larger than
the actual on-disk file size.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1401">#1401</a>: CouchDB Erlang views no longer crash in the <tt class="docutils literal"><span class="pre">couch_native</span></tt> process
with an unexpected <tt class="docutils literal"><span class="pre">function_clause</span></tt> error.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1419">#1419</a>: When deleting a file, CouchDB now properly ignores the configuration
flag <tt class="docutils literal"><span class="pre">enable_database_recovery</span></tt> when set when compacting databases, rather than
always retaining the old, renamed, uncompacted database file.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1439">#1439</a>: The CouchDB setup wizard now correctly validates bind_addresses. It
also no longer logs credentials by moving logging of internal wizard setup steps to
the <tt class="docutils literal"><span class="pre">debug</span></tt> level from the <tt class="docutils literal"><span class="pre">notice</span></tt> level.</p>
</li>
</ul>
</div>
<div class="section" id="mango">
<h3>15.1.2.4. Mango<a class="headerlink" href="#mango" title="Permalink to this headline">¶</a></h3>
<ul class="open">
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/816">#816</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/962">#962</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1038">#1038</a>: If a user specifies a value for
<tt class="docutils literal"><span class="pre">use_index</span></tt> that is not valid for the selector (does not meet coverage requirements
or proper sort fields), attempt to fall back to a valid index or full DB scan rather
than returning  a <tt class="docutils literal"><span class="pre">400</span></tt>.  If we fall back, populate a <tt class="docutils literal"><span class="pre">warning</span></tt> field in the
response. Mango also tries to use indexes where <tt class="docutils literal"><span class="pre">$or</span></tt> may select a field only when
certain values are present.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/849">#849</a>: When <tt class="docutils literal"><span class="pre">{&quot;seq_indexed&quot;:</span> <span class="pre">true}</span></tt> is specified, a badmatch error was
returned. This is now fixed.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/927">#927</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/1310">#1310</a>: Error messages when attempting to sort incorrectly are
now actually useful.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/951">#951</a>: When using <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/{db}/_index</span></tt>, only use a partial filter selector for
an index if it is set to something other than the default.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/961">#961</a>: Do not prefix <tt class="docutils literal"><span class="pre">_design/</span></tt> to a Mango index name whose user-specified
name already starts with <tt class="docutils literal"><span class="pre">_design/</span></tt>.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/988">#988</a>, <a class="reference external" href="https://github.com/apache/couchdb/issues/989">#989</a>: When specifying a <tt class="docutils literal"><span class="pre">use_index</span></tt> value with an invalid
index, correctly return a <tt class="docutils literal"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></tt> showing that the requested index is
invalid for the request specified.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/998">#998</a>: The fix for <a class="reference internal" href="../cve/2017-12635.html#cve-2017-12635"><em>CVE 2017-12635</em></a> presented a breaking
change to Mango&#8217;s <tt class="docutils literal"><span class="pre">/{db}/_find</span></tt>, which would evaluate all instances of all JSON
fields in a selector. Mango is now tested to ensure it only considers the last instance
of a field, silently ignoring those that appear before it.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1014">#1014</a>: Correctly deduce list of indexed fields in a selector when nested
<tt class="docutils literal"><span class="pre">$and</span></tt> operators are specified.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1023">#1023</a>: Fix an unexpected <tt class="docutils literal"><span class="pre">500</span></tt> error if <tt class="docutils literal"><span class="pre">startkey</span></tt> and <tt class="docutils literal"><span class="pre">endkey</span></tt> in a
Mango selector were reversed.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1067">#1067</a>: Prevent an <tt class="docutils literal"><span class="pre">invalid_cast</span></tt> crash when the <tt class="docutils literal"><span class="pre">couch_proc_manager</span></tt> soft
limit for processes is reached and mango idle processes are stopped.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1336">#1336</a>: The built-in fields <tt class="docutils literal"><span class="pre">_id</span></tt> and <tt class="docutils literal"><span class="pre">rev</span></tt> will always be covered by any
index, and Mango now correctly ignores their presence in any index that explicitly
includes them for selector matching purposes.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1376">#1376</a>: Mango now appropriately selects some indexes as usable for queries,
even if not all columns for an index are added to the query&#8217;s sort field list.</p>
</li>
<li><p class="first">Multiple fixes related to using Mango as a front-end for full text indexing (a feature
not shipped with couch, but for which support is in place as a compile-time addon).</p>
</li>
</ul>
</div>
<div class="section" id="other">
<h3>15.1.2.5. Other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h3>
<p>The 2.2.0 release also includes the following minor improvements:</p>
<ul class="open">
<li><p class="first">Developers can, at build time, enable curl libraries &amp; disable Fauxton and documentation
builds by specifying the new <tt class="docutils literal"><span class="pre">--dev</span></tt> option to the <tt class="docutils literal"><span class="pre">configure</span></tt> script.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">mochiweb</span></tt> dependency was bumped to version 2.17.0, in part to address the
difficult <a class="reference external" href="https://github.com/apache/couchdb/issues/745">#745</a> issue.</p>
</li>
<li><p class="first">Improved compatibility with newer versions of Erlang (20.x)</p>
</li>
<li><p class="first">Improved release process for CouchDB maintainers and PMC members.</p>
</li>
<li><p class="first">Multiple test suite improvements, focused on increased coverage, speed, and
reliability.</p>
</li>
<li><p class="first">Improvements to the Travis CI and Jenkins CI setups, focused on improved long-term
project maintenance and automatability.</p>
</li>
<li><p class="first">Related improvements to the CouchDB deb/rpm packaging and Docker repositories to
make deployment even easier.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1007">#1007</a>: Move <tt class="docutils literal"><span class="pre">etc/default.ini</span></tt> entries back into <tt class="docutils literal"><span class="pre">[replicator]</span></tt> section
(incorrectly moved to <tt class="docutils literal"><span class="pre">[couch_peruser]</span></tt> section)</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1245">#1245</a>: Increased debug-level logging for shard open errors is now available.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/apache/couchdb/issues/1296">#1296</a>: CouchDB by default now always invokes the SMP-enabled BEAM VM, even
on single-processor machines. A future release of Erlang will remove the non-SMP BEAM
VM entirely.</p>
</li>
<li><p class="first">A pony! OK, no, not really. If you got this far...thank you for reading.</p>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="2.1.html" class="btn btn-neutral float-right" title="15.2. 2.1.x Branch" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="15. Release History" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Software Foundation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.2.0',
            LANGUAGE:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>